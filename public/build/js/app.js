let paso=1;const pasoInicial=1,pasoFinal=5,solicitudPermiso={idsolicitud_permiso:"",fecha_solicitud:"",duracion_permiso:"",fecha_inicio:"",fecha_culminacion:"",nombre:"",motivos:[],id_usuario:""},solicitudVacaciones={id_solicitudes_vacaciones:"",fecha_solicitud_vacaciones:"",fecha_inicio_vacaciones:"",fecha_fin_vacaciones:"",id_usuario:"",nombreUsuarioVacaciones:""};function iniciarApp(){mostrarSeccion(),tabs(),botonesPaginador(),paginaSiguiente(),paginaAnterior(),consultarApi(),nombreUsuario(),obtenerId(),generarIdAleatorioPermiso(),seleccionarFechaSolicitud(),seleccionarFechaInicioPermiso(),seleccionarFechaFinPermiso(),diasPermiso(),seleccionarFechaSolicitudVacaciones(),seleccionarFechaInicioVacaciones(),seleccionarFechaFinVacaciones(),generarIdAleatorioVacaciones()}function mostrarSeccion(){const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar");const o=`#paso-${paso}`;document.querySelector(o).classList.add("mostrar");const a=document.querySelector(".actual");a&&a.classList.remove("actual");document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function tabs(){document.querySelectorAll(".tabs button").forEach((e=>{e.addEventListener("click",(function(e){paso=parseInt(e.target.dataset.paso),mostrarSeccion(),botonesPaginador()}))}))}function botonesPaginador(){const e=document.querySelector("#siguiente"),o=document.querySelector("#anterior");1===paso?(o.classList.add("ocultar"),e.classList.remove("ocultar")):5===paso?mostrarResumenVacaciones():4===paso?mostrarResumen():(o.classList.remove("ocultar"),e.classList.remove("ocultar")),mostrarSeccion()}function paginaAnterior(){document.querySelector("#anterior").addEventListener("click",(function(){paso<=1||(paso--,botonesPaginador())}))}function paginaSiguiente(){document.querySelector("#siguiente").addEventListener("click",(function(){paso>=5||(paso++,botonesPaginador())}))}async function consultarApi(){try{const e="http://localhost:3000/api/motivos",o=await fetch(e);mostrarMotivos(await o.json())}catch(e){console.log(e)}}function mostrarMotivos(e){e.forEach((e=>{const{idmotivos:o,nombre:a}=e,i=document.createElement("P");i.classList.add("nombre-motivos"),i.textContent=a;const t=document.createElement("DIV");t.classList.add("motivos"),t.dataset.idMotivo=o,t.onclick=function(){seleccionarMotivo(e)},t.appendChild(i),document.querySelector("#motivos").appendChild(t)}))}function seleccionarMotivo(e){const{idmotivos:o}=e,{motivos:a}=solicitudPermiso,i=document.querySelector(`[data-id-motivo="${o}"]`);a.some((e=>e.idmotivos===o))?(solicitudPermiso.motivos=a.filter((e=>e.idmotivos!=o)),i.classList.remove("seleccionado")):(solicitudPermiso.motivos=[...a,e],i.classList.add("seleccionado"))}function nombreUsuario(){solicitudPermiso.nombre=document.querySelector("#nombre").value,solicitudVacaciones.nombreUsuarioVacaciones=document.querySelector("#nombre").value}function obtenerId(){solicitudPermiso.id_usuario=document.querySelector("#miID").value,solicitudVacaciones.id_usuario=document.querySelector("#miID").value}function generarIdAleatorioPermiso(){solicitudPermiso.idsolicitud_permiso=Math.floor(1e4+9e4*Math.random())}function generarIdAleatorioVacaciones(){solicitudVacaciones.id_solicitudes_vacaciones=Math.floor(1e4+9e4*Math.random())}function seleccionarFechaSolicitud(){document.querySelector("#fecha_solicitud").addEventListener("input",(function(e){const o=new Date(e.target.value).getUTCDay();[6,0].includes(o)?(e.target.value="",mostrarAlertas("Compadre, los fines de semana no se dan permisos","error",".formulario")):solicitudPermiso.fecha_solicitud=e.target.value}))}function mostrarAlertas(e,o,a,i=!0){const t=document.querySelector(".alerta");t&&t.remove();const n=document.createElement("DIV");n.textContent=e,n.classList.add("alerta"),n.classList.add(o);document.querySelector(a).appendChild(n),i&&setTimeout((()=>{n.remove()}),3e3)}function seleccionarFechaInicioPermiso(){document.querySelector("#fecha_inicio").addEventListener("input",(function(e){const o=new Date(e.target.value).getUTCDay();[6,0].includes(o)?(e.target.value="",mostrarAlertas("Compadre, los fines de semana no se dan permisos","error",".formulario")):solicitudPermiso.fecha_inicio=e.target.value}))}function seleccionarFechaFinPermiso(){document.querySelector("#fecha_fin").addEventListener("input",(function(e){const o=new Date(e.target.value).getUTCDay();[6,0].includes(o)?(e.target.value="",mostrarAlertas("Compadre, los fines de semana no se dan permisos","error",".formulario")):solicitudPermiso.fecha_culminacion=e.target.value}))}function diasPermiso(){document.querySelector("#dias").addEventListener("input",(function(e){e.target.value<=0?mostrarAlertas("Compadre, los dias de permiso deben ser mayor o igual a 1","error",".formulario"):solicitudPermiso.duracion_permiso=e.target.value}))}function mostrarResumen(){const e=document.querySelector(".contenido-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(solicitudPermiso).includes("")||0===solicitudPermiso.motivos.length)return void mostrarAlertas("Compadre, te faltan datos por favor revisa","error",".contenido-resumen",!1);const{fecha_solicitud:o,duracion_permiso:a,fecha_inicio:i,fecha_culminacion:t,nombre:n,motivos:c}=solicitudPermiso,s=document.createElement("P");s.innerHTML=`<span>Nombre:</span>${n}`;const r=document.createElement("P");r.innerHTML=`<span>Fecha de la solicitud del permiso:</span>${o}`;const d=document.createElement("P");d.innerHTML=`<span>Dias de duracion del permiso:</span>${a}`;const l=document.createElement("P");l.innerHTML=`<span>Fecha en la que inicia el permiso:</span>${i}`;const u=document.createElement("P");u.innerHTML=`<span>Fecha en la que termina el permiso: </span>${t}`;const m=document.createElement("H3");m.textContent="Resumen del Permiso solicitado",e.appendChild(m),c.forEach((o=>{const{idmotivo:a,nombre:i}=o,t=document.createElement("DIV");t.classList.add("contenedor-motivos");const n=document.createElement("P");n.textContent=i,t.appendChild(n),e.appendChild(t)}));const p=document.createElement("H3");p.textContent="Datos del Permiso solicitado",e.appendChild(p),e.appendChild(s),e.appendChild(r),e.appendChild(d),e.appendChild(l),e.appendChild(u);const f=document.createElement("BUTTON");f.classList.add("boton"),f.textContent="Solicitar Permiso",f.onclick=registrarPermiso,e.appendChild(f)}async function registrarPermiso(){const{nombre:e,fecha_solicitud:o,duracion_permiso:a,fecha_inicio:i,fecha_culminacion:t,id_usuario:n,motivos:c,idsolicitud_permiso:s}=solicitudPermiso,r=c.map((e=>e.idmotivos)),d=new FormData;d.append("nombre_usuario",e),d.append("fecha_solicitud",o),d.append("duracion_permiso",a),d.append("fecha_inicio",i),d.append("fecha_culminacion",t),d.append("id_usuario",n),d.append("id_motivo",r),d.append("idsolicitud_permiso",s);const l=await fetch("http://localhost:3000/api/permisos",{method:"POST",body:d}),u=await l.json();console.log(u.resultado),u.resultado&&Swal.fire({icon:"success",title:"Permiso Solicitado",text:"Tu permiso fue creado correctamente",button:"OK"}).then((()=>{window.location.reload()}))}function seleccionarFechaSolicitudVacaciones(){document.querySelector("#fecha_solicitud_vacaciones").addEventListener("input",(function(e){const o=new Date(e.target.value).getUTCDay();[6,0].includes(o)?(e.target.value="",mostrarAlertas("Compadre, los fines de semana no puedes solicitar vacaciones","error",".formularioV")):solicitudVacaciones.fecha_solicitud_vacaciones=e.target.value}))}function seleccionarFechaInicioVacaciones(){document.querySelector("#fecha_inicio_vacaciones").addEventListener("input",(function(e){const o=new Date(e.target.value).getUTCDay();[6,0].includes(o)?(e.target.value="",mostrarAlertas("Compadre, los fines de semana no puedes solicitar vacaciones","error",".formularioV")):solicitudVacaciones.fecha_inicio_vacaciones=e.target.value}))}function seleccionarFechaFinVacaciones(){document.querySelector("#fecha_fin_vacaciones").addEventListener("input",(function(e){const o=new Date(e.target.value).getUTCDay();[6,0].includes(o)?(e.target.value="",mostrarAlertas("Compadre, los fines de semana no puedes solicitar vacaciones","error",".formularioV")):solicitudVacaciones.fecha_fin_vacaciones=e.target.value}))}function mostrarResumenVacaciones(){const e=document.querySelector(".contenido-resumen-vacaciones");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(solicitudVacaciones).includes(""))return void mostrarAlertas("Compadre, te faltan datos por favor revisa","error",".contenido-resumen-vacaciones",!1);const{nombreUsuarioVacaciones:o,fecha_solicitud_vacaciones:a,fecha_inicio_vacaciones:i,fecha_fin_vacaciones:t}=solicitudVacaciones,n=document.createElement("P");n.innerHTML=`<span>Nombre:</span>${o}`;const c=document.createElement("P");c.innerHTML=`<span>Fecha de la solicitud del permiso:</span>${a}`;const s=document.createElement("P");s.innerHTML=`<span>Fecha en la que inicia el permiso:</span>${i}`;const r=document.createElement("P");r.innerHTML=`<span>Fecha en la que termina el permiso: </span>${t}`;const d=document.createElement("H3");d.textContent="Resumen de las Vacaciones solicitadas",e.appendChild(d),e.appendChild(n),e.appendChild(c),e.appendChild(s),e.appendChild(r);const l=document.createElement("BUTTON");l.classList.add("boton"),l.textContent="Solicitar Vacaciones",l.onclick=registrarVacaciones,e.appendChild(l)}async function registrarVacaciones(){const{id_solicitudes_vacaciones:e,fecha_solicitud_vacaciones:o,fecha_inicio_vacaciones:a,fecha_fin_vacaciones:i,id_usuario:t}=solicitudVacaciones,n=new FormData;n.append("id_solicitudes_vacaciones",e),n.append("fecha_solicitud_vacaciones",o),n.append("fecha_inicio_vacaciones",a),n.append("fecha_fin_vacaciones",i),n.append("id_usuario",t);const c=await fetch("http://localhost:3000/api/vacaciones",{method:"POST",body:n}),s=await c.json();console.log(s),s.resultado&&Swal.fire({icon:"success",title:"Vacaciones Solicitadas",text:"Tus vacaciones fueron solicitadas correctamente",button:"OK"}).then((()=>{window.location.reload()}))}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));